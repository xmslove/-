({config:{auto:!0,coreLib:["../M/jquery.1.9.1.min.js"],model:{}},uid:0,count:0,map:{},rmap:{},jsReference:{},reference:{},cssArr:{},loaded:{},loadList:{},version:"1.0.1",init:function(){var that=this;!function(){var jsObj=function(a){var files=a.getElementsByTagName("script"),n=parseInt(files.length-1,10);return that.jsReference[0]=files[n],files[n]}(document);that.reference[0]=document.body.firstChild,function(a){var obj=a,initAuto=obj.getAttribute("auto"),initCore=obj.getAttribute("core");initAuto&&(that.config.auto="false"===initAuto.toLowerCase()?!1:!0),initCore&&(that.config.coreLib=initCore.split(","))}(jsObj||{})}(),window.M=function(){return that.method()}()},getMod:function(e){var mod,model=this.config.model;return mod="string"==typeof e?model[e]?model[e]:{path:e}:e},load:function(path,type,charset,fn){var node,t,that=this,done=function(){that.loaded[path]=1,fn()};"string"==typeof path?t=type||path.toLowerCase().split(/\./).pop().replace(/[\?#].*/,""):(path=path.join(""),t=type||path.toLowerCase().split(/\./).pop().replace(/[\?#].*/,"")),"js"===t?(node=document.createElement("script"),node.setAttribute("src",path),node.setAttribute("async",!0)):"css"===t&&(node=document.createElement("link"),node.setAttribute("href",path),node.setAttribute("type","text/css"),node.setAttribute("rel","stylesheet")),charset&&(node.charset=charset),node.onerror=function(){done(),node.onerror=null},node.onload=node.onreadystatechange=function(){this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(done(),node.onload=node.onreadystatechange=null)},that.jsReference[0].parentNode.insertBefore(node,that.jsReference[0])},check:function(deps,cb){var name=deps.join(""),mod=this.getMod(name),that=this,callback=(mod.path,function(){that.loadList[name]=1,cb()});mod.requires?this.check(mod.requires,function(m){return function(){that.load(m.path,m.type,m.charset,callback)}}(mod)):this.load(mod.path,mod.type,mod.charset,callback)},indexOf:Array.prototype.indexOf||function(obj){for(var i=0,len=this.length;len>i;++i)if(this[i]===obj)return i;return-1},release:function(res,list){for(var maps=this.map,fire=(this.rmap,function(callback,thisObj){setTimeout(function(){callback.call(thisObj)},0)}),i=0,len=list.length;len>i;++i){var uid=list[i],mapItem=maps[uid],waiting=mapItem.waiting,pos=this.indexOf.call(waiting,res);waiting.splice(pos,1),0===waiting.length&&(fire(mapItem.callback,mapItem.thisObj),delete maps[uid])}},method:function(){var that=this;return{run:function(){var fn,id,args=[].slice.call(arguments),len=parseInt(args.length,10);return that.uid++,that.config.auto&&that.loadList[that.config.coreLib.join("")]!==!0&&that.uid>1!=!0?(that.check(that.config.coreLib,function(){M.run.apply(that,args)}),M):len>0&&1===that.loadList[args[0]]!=!0?("function"==typeof args[len-1]&&(fn=args.pop()),id=args.join(""),(0===args.length||that.loadList[id])&&fn?(fn(),M):(that.check(args,function(){that.loadList[id]=1,fn&&fn()}),M)):M},set:function(m){if(m)for(var a in m)that.config.model[a]=m[a];return M},css:function(a,s){var css=document.getElementById("addCss");return css||(css=document.createElement("style"),css.type="text/css",css.id="addCss",that.reference[0].parentNode.insertBefore(css,that.reference[0])),that.cssArr[0]===a!=!0&&(that.cssArr[0]=a,css.styleSheet?css.styleSheet.cssText=css.styleSheet.cssText+s:css.appendChild(document.createTextNode(s))),M},add:function(name,obj){return name&&obj&&obj.path?(that.config.model[name]=obj,M):void 0},when:function(resources,callback,thisObj){var maps=that.map,rmaps=that.rmap;"string"==typeof resources&&(resources=[resources]);var id=(that.count++).toString(16);maps[id]={waiting:resources.slice(0),callback:callback,thisObj:thisObj||window};for(var i=0,len=resources.length;len>i;++i){var res=resources[i],list=rmaps[res]||(rmaps[res]=[]);list.push(id)}return M},trigger:function(resources){if(!resources)return M;var rmaps=(that.map,that.rmap);"string"==typeof resources&&(resources=[resources]);for(var i=0,len=resources.length;len>i;++i){var res=resources[i];"undefined"!=typeof rmaps[res]&&(that.release(res,rmaps[res]),delete rmaps[res])}return M}}}}).init();